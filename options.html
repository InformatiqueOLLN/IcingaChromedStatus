<html>
<head>
  <title>Icinga - Options</title>
  <script src="inc/jquery-1.4.2.min.js"></script>

  <link href="inc/jquery-ui/css/smoothness/jquery-ui-1.8.2.custom.css" rel="stylesheet" type="text/css"/>
  <script src="inc/jquery-ui/js/jquery-ui-1.8.2.custom.min.js"></script>

  <link href="icinga.css" rel="stylesheet" type="text/css"/>

<script type="text/javascript">
  // Saves options to localStorage.
  function save_options() {
  if (!window.localStorage) {
          alert("Error local storage is unavailable.");
          window.close();
  }

  window.localStorage.username = document.getElementById("username").value;
  if ( document.getElementById("password").value != '' )
    window.localStorage.password = document.getElementById("password").value;

  window.localStorage.url = document.getElementById("url").value;

  window.localStorage.url_base = window.localStorage.url.replace(/^(https?:\/\/[^\/]+)\/.*$/i, '$1');
  window.localStorage.url_icinga = window.localStorage.url.replace(/^(.*)\/[^\/]+.cgi$/i, '$1');

  // Update status to let user know options were saved.
  var status = document.getElementById("status");
  status.innerHTML = "Options Saved.";
  setTimeout(function() {
    status.innerHTML = "";
  }, 750);

  // refresh data
  chrome.extension.sendRequest({reqtype: "refresh-data"});
}

// Restores select box state to saved value from localStorage.
function restore_options() {
  if ( window.localStorage.username != undefined )
    document.getElementById("username").value = window.localStorage.username;
  if ( window.localStorage.url != undefined )
    document.getElementById("url").value = window.localStorage.url;
}

$(document).ready(function() {
  // show tabs
  $("#tabs").tabs();
  restore_options();
});

</script>
</head>

<body id="options">
<h3>Icinga Chromed Status &ndash; Options</h3>

<div id="tabs">
  <ul>
    <li><a href="#tab-1"><span>Main</span></a></li>
  </ul>

  <div id="tab-1">
    <div>
    <label for="username">Username</label> <input type="test" name="username" id="username" placeholder="Your Icinga Username" />
    </div>
    <div>
    <label for="password">Password</label> <input type="password" name="password" id="password" />
    </div>
    <div>
    <label for="url">URL to status.cgi</label> <input type="test" placeholder="i.e. https://monitoring.domain.com/icinga/cgi-bin/status.cgi" name="url" id="url" style="width: 400px;" />
    </div>

    <br />
    <button onclick="save_options()">Save</button>
    <span id="status"></span>

  </div>
  <!-- end of first tab -->
</div>

</body>
</html>
